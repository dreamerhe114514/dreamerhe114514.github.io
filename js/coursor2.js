class CrystalCursor{constructor(){if(!window.matchMedia("(hover: none)").matches){this.pos={curr:null,prev:null},this.trailParticles=[],this.clickParticles=[],this.trailLength=20,this.lastEmitTime=0,this.angle=0,this.currentPointer="normal",this.lerp=(e,t,s)=>(1-s)*e+s*t,this.cursor=document.createElement("div"),this.cursor.id="moonlight-cursor",this.cursor.className="hidden",this.cursor.innerHTML='\n            <div class="moon-disc"></div>\n            <div class="moon-crescent"></div>\n            <div class="moon-glow"></div>\n            <div class="moon-rings">\n                <div class="ring ring-1"></div>\n                <div class="ring ring-2"></div>\n                <div class="ring ring-3"></div>\n            </div>\n        ',document.body.append(this.cursor);for(let e=0;e<this.trailLength;e++){const t=document.createElement("div");t.className="crystal-trail",t.style.setProperty("--i",e),document.body.appendChild(t),this.trailParticles.push({el:t,pos:{x:0,y:0},size:1+1.5*Math.random(),delay:.02*e,life:0,speed:.5+.5*Math.random(),angle:0})}this.initEventListeners(),this.raf=requestAnimationFrame((()=>this.render()))}}initEventListeners(){this.mouseMoveHandler=e=>this.handleMouseMove(e),this.mouseEnterHandler=()=>this.cursor.classList.remove("hidden"),this.mouseLeaveHandler=()=>this.cursor.classList.add("hidden"),this.mouseDownHandler=e=>this.handleMouseDown(e),this.mouseUpHandler=()=>this.cursor.classList.remove("active"),document.addEventListener("mousemove",this.mouseMoveHandler),document.addEventListener("mouseenter",this.mouseEnterHandler),document.addEventListener("mouseleave",this.mouseLeaveHandler),document.addEventListener("mousedown",this.mouseDownHandler),document.addEventListener("mouseup",this.mouseUpHandler),this.hoverElements=document.querySelectorAll("a, button, [data-hover]"),this.hoverElements.forEach((e=>{e.addEventListener("mouseenter",this.handleHoverEnter.bind(this)),e.addEventListener("mouseleave",this.handleHoverLeave.bind(this))})),this.textElements=document.querySelectorAll("input, textarea, [contenteditable]"),this.textElements.forEach((e=>{e.addEventListener("mouseenter",(()=>this.setPointer("text"))),e.addEventListener("mouseleave",(()=>this.setPointer("normal")))})),this.disabledElements=document.querySelectorAll("[disabled]"),this.disabledElements.forEach((e=>{e.addEventListener("mouseenter",(()=>this.setPointer("unavailable"))),e.addEventListener("mouseleave",(()=>this.setPointer("normal")))})),this.draggableElements=document.querySelectorAll('[draggable="true"]'),this.draggableElements.forEach((e=>{e.addEventListener("mouseenter",(()=>this.setPointer("move"))),e.addEventListener("mouseleave",(()=>this.setPointer("normal")))}))}handleMouseMove(e){const t=Date.now();if(t-this.lastEmitTime>16){if(null===this.pos.curr&&this.move(e.clientX-6,e.clientY-6),this.pos.curr={x:e.clientX,y:e.clientY},this.cursor.classList.remove("hidden"),this.pos.prev){const e=this.pos.curr.x-this.pos.prev.x,t=this.pos.curr.y-this.pos.prev.y;this.angle=Math.atan2(t,e)}this.activateTrailParticle(),this.lastEmitTime=t}}handleMouseDown(e){this.cursor.classList.add("active");const t=window.scrollX||window.pageXOffset,s=window.scrollY||window.pageYOffset;this.createCrystalBurst(e.clientX+t,e.clientY+s),this.createShockwave(e.clientX+t,e.clientY+s)}handleHoverEnter(e){this.setPointer("link"),this.cursor.classList.add("hover");const t=e.target.getBoundingClientRect();this.createRippleEffect(t)}handleHoverLeave(){this.setPointer("normal"),this.cursor.classList.remove("hover")}setPointer(e){this.currentPointer=e;const t={normal:"url(/img/normal.cur), default",link:"url(/img/link.cur), pointer",text:"url(/img/text.cur), text",move:"url(/img/move.cur), move",help:"url(/img/help.cur), help",unavailable:"url(/img/unavailable.cur), not-allowed",busy:"url(/img/busy.ani), wait",working:"url(/img/working.ani), progress",precision:"url(/img/precision.cur), crosshair"};document.body.style.cursor=t[e]||t.normal}move(e,t){this.cursor.style.left=`${e}px`,this.cursor.style.top=`${t}px`}activateTrailParticle(){const e=this.trailParticles.find((e=>e.life<=0));if(e&&this.pos.prev){e.life=1,e.pos.x=this.pos.prev.x,e.pos.y=this.pos.prev.y,e.size=1+2*Math.random(),e.el.style.width=`${e.size}px`,e.el.style.height=1.5*e.size+"px",e.el.style.opacity="0.8",e.el.style.borderRadius="50%",this.angle&&(e.angle=this.angle,e.el.style.transform=`translate(-50%, -50%) rotate(${e.angle+Math.PI/2}rad)`);const t=270+30*Math.random()-15;e.el.style.background=`linear-gradient(to bottom, \n                hsla(${t}, 100%, 70%, 0.9), \n                hsla(${t+20}, 100%, 50%, 0.5))`,e.el.style.boxShadow=`0 0 5px hsla(${t}, 100%, 70%, 0.8)`}}createCrystalBurst(e,t){const s=["#8a2be2","#9932cc","#ba55d3","#da70d6","#d8bfd8"];for(let r=0;r<50;r++){const r=document.createElement("div");r.className="crystal-burst",r.style.left=`${e}px`,r.style.top=`${t}px`,r.style.backgroundColor=s[Math.floor(Math.random()*s.length)],document.body.appendChild(r);const o=Math.random()*Math.PI*2,i=.5+2*Math.random(),n=800+400*Math.random(),a=2+12*Math.random(),l=360*Math.random();r.style.width=`${a}px`,r.style.height=`${a}px`,r.style.transform=`rotate(${l}deg)`,r.style.clipPath="polygon(50% 0%, 0% 100%, 100% 100%)";const h=s=>{const a=(Date.now()-s)/n;if(a>=1)return void r.remove();const c=i*a*50,d=e+Math.cos(o)*c,m=t+Math.sin(o)*c,u=1-a,v=.5+.5*a;r.style.transform=`translate(${d-e}px, ${m-t}px) rotate(${l+360*a}deg) scale(${v})`,r.style.opacity=u,requestAnimationFrame((()=>h(s)))};requestAnimationFrame((()=>h(Date.now())))}}createShockwave(e,t){const s=document.createElement("div");s.className="shockwave",s.style.left=`${e}px`,s.style.top=`${t}px`,document.body.appendChild(s);const r=Date.now(),o=()=>{const e=(Date.now()-r)/600;if(e>=1)return void s.remove();const t=50*e,i=1-e;s.style.width=`${t}px`,s.style.height=`${t}px`,s.style.opacity=i,s.style.borderWidth=1-1*e+"px",requestAnimationFrame(o)};requestAnimationFrame(o)}createRippleEffect(e){const t=window.scrollX||window.pageXOffset,s=window.scrollY||window.pageYOffset,r=document.createElement("div");r.className="ripple-effect",r.style.left=`${e.left+e.width/2+t}px`,r.style.top=`${e.top+e.height/2+s}px`,document.body.appendChild(r),setTimeout((()=>{r.remove()}),1e3)}render(){if(this.pos.prev&&this.pos.curr){this.pos.prev.x=this.lerp(this.pos.prev.x,this.pos.curr.x,.2),this.pos.prev.y=this.lerp(this.pos.prev.y,this.pos.curr.y,.2),this.move(this.pos.prev.x-6,this.pos.prev.y-6),this.trailParticles.forEach((e=>{if(e.life>0){e.life-=.02*e.speed;const t=15*(1-e.life);e.pos.x+=Math.cos(e.angle)*t*.1,e.pos.y+=Math.sin(e.angle)*t*.1,e.el.style.left=`${e.pos.x}px`,e.el.style.top=`${e.pos.y}px`,e.el.style.opacity=.8*e.life;const s=3+2.5*(1-e.life);e.el.style.height=e.size*s+"px",e.life<=0&&(e.el.style.opacity="0")}}));const e=.3*Math.abs(Math.sin(.003*Date.now()))+.7;this.cursor.querySelector(".moon-glow").style.opacity=e;const t=.2*Math.abs(Math.sin(.002*Date.now()))+.8;this.cursor.querySelector(".ring-1").style.transform=`translate(-50%, -50%) scale(${t})`,this.cursor.querySelector(".ring-2").style.transform=`translate(-50%, -50%) scale(${1.1*t})`,this.cursor.querySelector(".ring-3").style.transform=`translate(-50%, -50%) scale(${1.2*t})`}else this.pos.prev=this.pos.curr;this.raf=requestAnimationFrame((()=>this.render()))}destroy(){cancelAnimationFrame(this.raf),document.removeEventListener("mousemove",this.mouseMoveHandler),document.removeEventListener("mouseenter",this.mouseEnterHandler),document.removeEventListener("mouseleave",this.mouseLeaveHandler),document.removeEventListener("mousedown",this.mouseDownHandler),document.removeEventListener("mouseup",this.mouseUpHandler),this.hoverElements.forEach((e=>{e.removeEventListener("mouseenter",this.handleHoverEnter),e.removeEventListener("mouseleave",this.handleHoverLeave)})),this.textElements.forEach((e=>{e.removeEventListener("mouseenter",(()=>this.setPointer("text"))),e.removeEventListener("mouseleave",(()=>this.setPointer("normal")))})),this.disabledElements.forEach((e=>{e.removeEventListener("mouseenter",(()=>this.setPointer("unavailable"))),e.removeEventListener("mouseleave",(()=>this.setPointer("normal")))})),this.draggableElements.forEach((e=>{e.removeEventListener("mouseenter",(()=>this.setPointer("move"))),e.removeEventListener("mouseleave",(()=>this.setPointer("normal")))})),this.cursor.remove(),this.trailParticles.forEach((e=>e.el.remove())),document.body.style.cursor=""}}(()=>{const e=new CrystalCursor;window.addEventListener("beforeunload",(()=>{e.destroy()}))})();